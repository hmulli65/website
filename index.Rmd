---
title: "SQL"
output: html_document
---

## Filtering rows and columns

In sql you can filter rows by using WHERE and columns by using SELECT. Let's look at an example using the Lahman basebal database. First, we should load the Lahman package and the sqldf package. 

```{r warning=FALSE, message=FALSE}
library(Lahman)
library(sqldf)
```

```
Let's take a look at an example. If we want to see the homerun totals for the 1927 yankees. We could write:

```{r}
query<-"SELECT playerID,teamID,yearID,HR FROM Batting
WHERE teamID='NYA' and yearID=1927"
sqldf(query)
```


Find all instances where the Yankees have 40 homeruns or more.
```{r}
query<-"SELECT teamID, playerID, yearID, HR FROM Batting
WHERE teamID='NYA' and HR>=40"
sqldf(query)
```


Find all instances where a player had more than 40 homeruns and less than 60 strikeouts.
```{r}
query<-"SELECT teamID, playerID, yearID, HR, SO FROM Batting
WHERE HR>40 and SO<60"
sqldf(query)
```


 Find all instances where the Phillies in the 1970s hitting more than 30 homeruns.
 
```{r}
query<-"SELECT teamID, playerID, yearID, HR FROM Batting 
WHERE teamID='PHI' and HR>30 and yearID>=1970 and yearID<=1979"
sqldf(query)
```
#--------------------------------------------------------------

## Order By
In SQL you can order things by using the ORDER BY command. This will always be the last command. Bellow is an example:

Find all instances of players striking out less than 10 times. Make sure each player has at least 400 at bats.

```{r}
query<-"SELECT playerID, teamID, yearID, SO, AB FROM Batting
WHERE SO<10 and AB>=400
ORDER BY SO"
sqldf(query)
```
#--------------------------------------------------------------

##Aggregation
Aggregation allows you to group the information. It is done with the GROUP BY command. If you wanted to add a WHERE clause for within the group you must use the command HAVING after the GROUP BY command. Some important commands that also fall under this category include sum( ), avg( ), max( ), and min( ). Bellow are some examples:

What is the total homeruns of Babe ruth?
```{r}
query<-"SELECT playerID, sum(HR) FROM Batting 
WHERE playerID='ruthba01'
GROUP BY playerID"
sqldf(query)
```


Find the career homerun totals for all players, but list only those with a total of 600 or more. Order from greatest to least.

```{r}
query<-"SELECT playerID, sum(HR) FROM Batting
GROUP BY playerID
HAVING sum(HR)>=600
ORDER BY sum(HR) DESC"
sqldf(query)
```


What players have the highest average per season homerun totals? List only averages over 30.

```{r}
query<-"SELECT playerID, avg(HR) FROM Batting
GROUP BY playerID
HAVING avg(HR)>30
ORDER BY avg(HR) DESC"
sqldf(query)
```

#-------------------------------------------------------------

##Joins
The commands used for this action include INNER JOIN and ON. INNER JOIN allows you to connect two seperate tables. ON tells the program how to connect them.

Find the first and last name, along with team, year, and homeruns. The only player should be Babe Ruth.
```{r}
query<-"SELECT nameFirst, nameLast, teamID, yearID, HR
FROM Batting INNER JOIN Master
ON Batting.playerID=Master.playerID
WHERE Batting.playerID='ruthba01'"
sqldf(query)
```

Find all instances of players hitting more than 50 homeruns. Include first name, last name, team, year, and homeruns. Order them from greates homeruns to least.
```{r}
query<-"SELECT nameFirst, nameLast, teamID, yearID, HR
FROM Batting INNER JOIN Master
ON Batting.playerID=Master.playerID
WHERE HR>50
ORDER BY HR DESC"
sqldf(query)
```

Babe Ruth with playerID, team name, yearID, and homeruns. For this example we must join the tables at two spots otherwise there will be repeats.
```{r}
query<-"SELECT playerID, name, Batting.yearID, Batting.HR
FROM Batting INNER JOIN Teams
ON Batting.teamID=Teams.teamID and Batting.yearID=Teams.yearID
WHERE playerID='ruthba01'"
sqldf(query)
```


